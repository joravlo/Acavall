
{% extends 'base.html.twig' %}

{% block stylesheets %}
  <link rel="stylesheet" href="{{ asset('css/manage.css') }}">
{% endblock %}

{% block javascripts %}
  <script src="{{ asset('js/gestor.js') }}" type="text/javascript"></script>
{% endblock %}

{% block body %}
  <div class="container general" style="padding:0px;">
    <ul id="mul" class="list-group">

      <div class="list-head">
        <div class="row">
          <div class="col-md-2"><h5>Eventos<h5></div>

          <div class="col-md-7">
            <div id="input" style="display:none;">
              <div class="form-group">
                <input type="text"  id="date" name="date" placeholder="Desde" style="width:120px;"/>&nbsp; / &nbsp;
                <input type="text"  id="date" name="date" placeholder="hasta" style="width:120px;"/>&nbsp;&nbsp;&nbsp;
                <input type="text"  id="myInput" onkeyup="filtrar()" placeholder="Nombre evento" style="width:200px;">
              </div>
            </div>
          </div>

          <div class="col-md-3">
            <button id="eventFilter" style="color:white; margin-left:40px" type="button" class="btn btn-outline-secondary btn-sm">Filtrar</button>
            <a style="text-decoration:none;" href="{{ path('event_add') }}">
              <button style="color:white;" type="button" class="btn btn-outline-secondary btn-sm">Nuevo evento</button>
            </a>
          </div>
        </div>
      </div>

      <div style="padding:10px; background:white; border: 1px solid #ECE9E8;">
        <div class="row" style="color:grey;">
          <div class="col-md-2 text-center" style="margin-left:12px;"><b>Id</b></div>
          <div class="col-md-2 text-center"><b>Nombre</b></div>
          <div class="col-md-8"></div>
        </div>
      </div>

      {% for evento in eventos %}

        <li class="list-group-item text-center">
          <div class="row" >
            <div class="col-md-2 text-center">{{ evento.id }}</div>
            <div class="col-md-2 text-center">{{ evento.name }}</div>
            <div class="col-md-8" style="opacity:0.9;">
              <a style="text-decoration:none;" href="{{ path('event_update',{ 'eventId': evento.id }) }}">
                <button type="button" class="btn btn-warning btn-sm" style="color:white;">Editar</button>
              </a>
              <a id="{{ evento.id }}" href="#modalDelete" data-toggle="modal">
                <button type="button" class="btn btn-danger btn-sm">Eliminar</button>
              </a>
              <a id="{{ evento.id }}" href="#modalPost" data-toggle="modal">
                <button type="button" class="btn btn-success btn-sm">Publicar</button>
              </a>
            </div>
          </div>
        </li>

      {% endfor %}

    </ul>

    <div class="navigation">
      {{ knp_pagination_render(eventos) }}
    </div>

  </div>

  <!-- Modal eliminar -->
  <div class="modal" id="modalDelete">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-body">
        <h4>Acción eliminar evento</h4><br>
        <p>Seguro que desea eliminar este evento?</p>
        </div>
        <div class="modal-footer">
          <a href="#" id="btnYD" data-dismiss="modal" aria-hidden="true" class="btn danger">Yes</a>
          <a href="#" data-dismiss="modal" aria-hidden="true" class="btn secondary">No</a>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal publicar -->
  <div class="modal" id="modalPost">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-body">
        <h4>Acción publicar evento</h4><br>
        <p>Seguro que desea publicar este evento?</p>
        </div>
        <div class="modal-footer">
          <a href="#" id="btnYP" data-dismiss="modal" aria-hidden="true" class="btn danger">Yes</a>
          <a href="#" data-dismiss="modal" aria-hidden="true" class="btn secondary">No</a>
        </div>
      </div>
    </div>
  </div>

  <script>

    function deleteEvent(eveId) {
      $(function(){
          $.ajax({
            type: 'DELETE',
            url: 'http://localhost:8000/api/deleteEvent/' + eveId,
            success: function(data) {

            }
          })
      });
    }

    function publicarEvent(eveId) {
      $(function(){
          $.ajax({
            type: 'PUT',
            url: 'http://localhost:8000/api/publicarEvent/' + eveId,
            success: function(data) {
            }
          })
      });
    }

    function filtrar() {
        var input, filter, ul, li, a, i;
        input = document.getElementById("myInput");
        filter = input.value.toUpperCase();
        ul = document.getElementById("mul");
        li = ul.getElementsByTagName("li");
        for (i = 0; i < li.length; i++) {
            a = li[i].getElementsByTagName("div")[0];
            if (a.innerHTML.toUpperCase().indexOf(filter) > -1) {
                li[i].style.display = "";
            } else {
                li[i].style.display = "none";
            }
        }
    }

    $('#modalDelete').on('show.bs.modal', function (e) {
      var eveIdD = e.relatedTarget.id;
      $('#btnYD').click(function() {
        deleteEvent(eveIdD);
        deleteLine(eveIdD);
      });
    });

    $('#modalPost').on('show.bs.modal', function (e) {
      var eveIdP = e.relatedTarget.id;
      $('#btnYP').click(function() {
        publicarEvent(eveIdP);
      });
    });

    function deleteLine(eveId)
    {
      ul = document.getElementById("mul");
      li = ul.getElementsByTagName("li");
      for (i = 0; i < li.length; i++) {
        a = li[i].getElementsByTagName("div")[0];
        if (a.innerHTML.indexOf(eveId) > -1) {
          li[i].style.display = "none";
        }
      }
    }

  </script>
{% endblock %}
